<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up - Marketplace</title>
  <link rel="stylesheet" href="signup.css" />
  <style>
    * {
    box-sizing: border-box;
    padding: 0;
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
  }
  .marketplace-glow {
    color: #00c292;
    text-shadow: 0 0 5px #00c292, 0 0 10px #00c292, 0 0 15px #00c292;
    font-weight: bold;
  }  
  
  body {
    height: 100vh;
    background: #f9f9f9;
  }
  
  .auth-wrapper {
    display: flex;
    height: 100vh;
    flex-direction: row;
  }
  
  .auth-left, .auth-right {
    width: 50%;
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  
  .auth-left {
    background-color: #222;
    color: white;
    text-align: center;
  }
  
  .auth-left img {
    max-width: 300px;
    width: 100%;
    margin-bottom: 20px;
    border-radius: 12px;
  }
  
  .auth-left .highlight {
    color: #00c292;
  }
  
  .auth-right {
    background: linear-gradient(to bottom, #ffffff, #f5f5f5);
    box-shadow: -5px 0 10px rgba(0, 0, 0, 0.05);
  }
  
  .auth-right h2 {
    margin-bottom: 25px;
    font-size: 28px;
  }
  
  form {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 350px;
  }
  
  form input {
    padding: 12px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  
  form input:focus {
    outline: none;
    border-color: #00c292;
    box-shadow: 0 0 0 2px rgba(0, 194, 146, 0.2);
  }
  
  form button {
    padding: 12px;
    background-color: #00c292;
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  form button:hover {
    background-color: #00a47c;
  }
  
  .auth-switch {
    margin-top: 20px;
    font-size: 14px;
  }
  
  .auth-switch a {
    color: #00c292;
    text-decoration: none;
  }
  
  @media (max-width: 768px) {
    .auth-wrapper {
      flex-direction: column;
    }
  
    .auth-left, .auth-right {
      width: 100%;
      padding: 40px 20px;
    }
  
    .auth-left img {
      width: 80%;
      max-width: 250px;
    }
  
    .auth-right {
      box-shadow: none;
    }
  }
  </style>
  </head>
<body>
  <div class="auth-wrapper">
    <!-- Left Side Image/Promo -->
    <div class="auth-left">
      <img src="../images/food-market.jpg" alt="Marketplace Promo" />
      <h1>Welcome to <span class="marketplace-glow">Marketplace</span></h1>
      <p>Buy and sell on campus easily and safely</p>
    </div>

    <!-- Right Side Form -->
    <div class="auth-right">
      <h2>Create an Account</h2>
      <form id="signUpForm">
        <input type="email" id="signUpEmail" placeholder="Email" required />
        <input type="password" id="signUpPassword" placeholder="Password" required />
        <button type="submit">Sign Up</button>
      </form>
      <p class="auth-switch">
        Already have an account? <a href="../index.html">Sign In here</a>
      </p>
    </div>
  </div>
  <!-- Include Firebase CDN -->

<script type = "module">
  // Import Firebase modules from CDN
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js';
import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBzPa671GH71UvTcZ3dECFPrW4xe1vS9ds",
  authDomain: "marketplace-e0bff.firebaseapp.com",
  projectId: "marketplace-e0bff",
  storageBucket: "marketplace-e0bff.appspot.com",
  messagingSenderId: "892936444768",
  appId: "1:892936444768:web:f595b3a3e5d697988e1c05"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app, "https://marketplace-e0bff-default-rtdb.europe-west1.firebasedatabase.app");

// Sign-up function
async function signUp(email, password) {
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    console.log("User signed up:", user);

    // Store user details in Realtime Database
/*    const username = email.split('@')[0].replace(/[.#$\[\]]/g, '_'); // sanitize key
    await set(ref(db, 'users/' + username), {
      email: email,
      role: "user",
      approved: false,
      banned: false,
      declined: false
    });
*/
    // Send email verification
    await sendEmailVerification(user, {
      url: 'http://localhost:5500/formpage/foorm.html', // change in production
      handleCodeInApp: false
    });

    console.log("Verification email sent");

    // Redirect to verification page
    window.localStorage.setItem("pendingEmail", email); 
    window.location.href = "../emailverification/verify-email.html"; 

  } catch (error) {
    console.error("Sign-Up Error:", error.message);
    alert("Error: " + error.message);
  }
}

// Event listener for sign-up form submission
document.getElementById("signUpForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const email = document.getElementById("signUpEmail").value;
  const password = document.getElementById("signUpPassword").value;
  signUp(email, password);
});

</script>
</body>

<footer>
  <p>&copy; 2025 Marketplace. All rights reserved.</p>
</html>
